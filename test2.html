<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>測試搜尋功能</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        input, select { padding: 10px; margin: 10px 0; width: 300px; }
        #result { margin-top: 20px; padding: 10px; background: #f0f0f0; }
    </style>
</head>
<body>
    <h1>測試搜尋功能</h1>

    <input type="text" id="searchInput" placeholder="輸入品牌搜尋（如：豐田）">
    <div id="searchCount"></div>

    <select id="carBrand">
        <option value="">請選擇廠牌車款</option>
    </select>

    <div id="result"></div>

    <script src="car-data.js"></script>
    <script>
        var allCarOptions = [];
        var resultDiv = document.getElementById('result');
        var select = document.getElementById('carBrand');
        var searchInput = document.getElementById('searchInput');
        var searchCount = document.getElementById('searchCount');

        // 初始化
        window.onload = function() {
            if (typeof carDatabase === 'undefined') {
                resultDiv.innerHTML = '<p style="color:red">錯誤：carDatabase 未定義</p>';
                return;
            }

            // 建立 allCarOptions 陣列
            Object.keys(carDatabase).forEach(function(brand) {
                var brandData = carDatabase[brand];
                if (brandData.models && Array.isArray(brandData.models)) {
                    brandData.models.forEach(function(model) {
                        allCarOptions.push({
                            value: JSON.stringify({brand: brand, model: model.name}),
                            text: brand + ' - ' + model.name
                        });
                    });
                }
            });

            resultDiv.innerHTML = '<p style="color:green">allCarOptions 有 ' + allCarOptions.length + ' 個車款</p>';

            // 填入下拉選單
            showAllOptions();
        };

        // 顯示所有選項
        function showAllOptions() {
            select.innerHTML = '<option value="">請選擇廠牌車款</option>';
            allCarOptions.forEach(function(opt) {
                var option = document.createElement('option');
                option.value = opt.value;
                option.textContent = opt.text;
                select.appendChild(option);
            });
            searchCount.textContent = '共 ' + allCarOptions.length + ' 款';
        }

        // 搜尋功能
        searchInput.addEventListener('input', function() {
            var keyword = this.value.trim().toLowerCase();

            if (!keyword) {
                showAllOptions();
                return;
            }

            select.innerHTML = '<option value="">請選擇廠牌車款</option>';
            var count = 0;

            allCarOptions.forEach(function(opt) {
                var text = opt.text.toLowerCase();
                if (text.includes(keyword)) {
                    var option = document.createElement('option');
                    option.value = opt.value;
                    option.textContent = opt.text;
                    select.appendChild(option);
                    count++;
                }
            });

            if (count > 0) {
                searchCount.innerHTML = '<span style="color:green">找到 ' + count + ' 款</span>';
            } else {
                searchCount.innerHTML = '<span style="color:red">無結果</span>';
            }
        });
    </script>
</body>
</html>
